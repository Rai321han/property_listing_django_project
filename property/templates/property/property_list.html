{% extends 'property/base.html' %}
{% load static %}

{% block title %}Properties{% if selected_location %} in {{ selected_location.name }}{% endif %} - Property Listing{% endblock %}

{% block page_css %}
<link rel="stylesheet" href="{% static 'css/property_list.css' %}">
<link rel="stylesheet" href="{% static 'css/pagination.css' %}">
{% endblock %}

{% block content %}
<section class="list-section">
    <div class="container">
        <div class="list-header">
            <h1>
                {% if selected_location %}
                Properties in {{ selected_location.name }}, {{ selected_location.city }}, {{selected_location.country}}
                {% elif search_query%}
                Properties for search term '{{search_query}}'
                {% else %}
                All Properties
                {% endif %}
            </h1>
            <p class="property-count">{{count }} properties available</p>
        </div>

        <div class="property-grid">
            {% for property in properties %}
            <div class="property-card">
                <a href="{% url 'property:property_detail' property.pk %}" class="card-link">
                    <div class="property-image">
                        {% if property.primary_image %}
                            <img src="{{ property.primary_image.image.url }}" alt="{{ property.title }}">
                        {% else %}
                            <div class="image-placeholder"></div>
                        {% endif %}
                    </div>

                    <div class="property-content">
                        <div class="property-header">
                            <h3 class="property-title">{{ property.title }}</h3>
                            <p class="property-location">{{ property.location.name }}, {{ property.location.city }}, {{ property.location.country }}</p>
                        </div>

                        <div class="property-details">
                            <span class="detail-item">{{ property.bedrooms }} bed</span>
                            <span class="detail-separator">·</span>
                            <span class="detail-item">{{ property.bathrooms }} bath</span>
                        </div>

                        <div class="property-price">{{ property.formatted_price }}</div>
                    </div>
                </a>
            </div>
            {% empty %}
            <div class="no-results">
                <p>No properties found matching your criteria.</p>
            </div>
            {% endfor %}
        </div>

{% if page_obj.has_other_pages %}
<div class="pagination">

    {# Previous #}
    {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&location={{ search_query }}{% endif %}">
            ←
        </a>
    {% endif %}

    {# First page #}
    {% if page_obj.number > 3 %}
        <a href="?page=1{% if search_query %}&location={{ search_query }}{% endif %}">1</a>
        <span class="dots">…</span>
    {% endif %}

    {# Pages around current #}
    {% for num in page_obj.paginator.page_range %}
        {% if num >= page_obj.number|add:"-2" and num <= page_obj.number|add:"2" %}
            {% if page_obj.number == num %}
                <span class="current">{{ num }}</span>
            {% else %}
                <a href="?page={{ num }}{% if search_query %}&location={{ search_query }}{% endif %}">
                    {{ num }}
                </a>
            {% endif %}
        {% endif %}
    {% endfor %}

    {# Last page #}
    {% if page_obj.number < page_obj.paginator.num_pages|add:"-2" %}
        <span class="dots">…</span>
        <a href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&location={{ search_query }}{% endif %}">
            {{ page_obj.paginator.num_pages }}
        </a>
    {% endif %}

    {# Next #}
    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&location={{ search_query }}{% endif %}">
            →
        </a>
    {% endif %}

</div>
{% endif %}


    </div>
</section>
{% endblock %}