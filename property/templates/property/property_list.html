{% extends 'property/base.html' %}
{% load static %}

{% block title %}Properties{% if selected_location %} in {{ selected_location.name }}{% endif %} - Property Listing{% endblock %}

{% block content %}
<section class="list-section">
    <div class="container">
        <div class="list-header">
            <h1>
                {% if selected_location %}
                Properties in {{ selected_location.name }}, {{ selected_location.city }}
                {% else %}
                All Properties
                {% endif %}
            </h1>
            <p>{{ properties.count }} properties found</p>
        </div>

        <div class="filters">
            <form method="get" class="filter-form">
                {% if selected_location %}
                <input type="hidden" name="location" value="{{ selected_location.id }}">
                {% endif %}
                
                <select name="type">
                    <option value="">All Types</option>
                    {% for value, label in property_types %}
                    <option value="{{ value }}" {% if request.GET.type == value %}selected{% endif %}>
                        {{ label }}
                    </option>
                    {% endfor %}
                </select>

                <input type="number" name="min_price" placeholder="Min Price" value="{{ request.GET.min_price }}">
                <input type="number" name="max_price" placeholder="Max Price" value="{{ request.GET.max_price }}">
                
                <select name="bedrooms">
                    <option value="">Any Bedrooms</option>
                    <option value="1" {% if request.GET.bedrooms == "1" %}selected{% endif %}>1+</option>
                    <option value="2" {% if request.GET.bedrooms == "2" %}selected{% endif %}>2+</option>
                    <option value="3" {% if request.GET.bedrooms == "3" %}selected{% endif %}>3+</option>
                    <option value="4" {% if request.GET.bedrooms == "4" %}selected{% endif %}>4+</option>
                </select>

                <button type="submit">Apply Filters</button>
                <a href="{% url 'property:property_list' %}" class="btn-reset">Reset</a>
            </form>
        </div>

        <!-- <div class="property-grid">
            {% for property in properties %}
            <div class="property-card">
                <a href="{% url 'property:property_detail' property.pk %}">
                    {% if property.primary_image %}
                    <img src="{{ property.primary_image.image.url }}" alt="{{ property.title }}">
                    {% else %}
                    <img src="{% static 'img/placeholder.jpg' %}" alt="{{ property.title }}">
                    {% endif %}
                    <div class="property-info">
                        <h3>{{ property.title }}</h3>
                        <p class="location">üìç {{ property.location.name }}, {{ property.location.city }}</p>
                        <p class="price">{{ property.formatted_price }}</p>
                        <div class="property-details">
                            <span>üõèÔ∏è {{ property.bedrooms }} bed</span>
                            <span>üöø {{ property.bathrooms }} bath</span>
                        </div>
                    </div>
                </a>
            </div>
            {% empty %}
            <p class="no-results">No properties found. Try adjusting your filters.</p>
            {% endfor %}
        </div> -->

<div class="property-grid">
    {% for property in properties %}
    <div class="property-card">
        <a href="{% url 'property:property_detail' property.pk %}">
            <div class="property-image">
                {% if property.primary_image %}
                    <img src="{{ property.primary_image.image.url }}" alt="{{ property.title }}">
                {% else %}
                    <img src="{% static 'img/placeholder.jpg' %}" alt="{{ property.title }}">
                {% endif %}
            </div>

            <div class="property-body">
                <h3 class="property-title">{{ property.title }}</h3>

                <p class="property-location">
                    üìç {{ property.location.name }}, {{ property.location.city }}
                </p>

                <p class="property-description">
                    {{ property.description|truncatechars:90 }}
                </p>

                <div class="property-meta">
                    <span>üõè {{ property.bedrooms }}</span>
                    <span>üöø {{ property.bathrooms }}</span>
                    <span class="rating">‚≠ê 4.9</span>
                </div>

                <div class="property-footer">
                    <span class="price">{{ property.formatted_price }}</span>
                    <button class="btn-primary">Reserve</button>
                </div>
            </div>
        </a>
    </div>
    {% empty %}
    <p class="no-results">No properties found.</p>
    {% endfor %}
</div>

    </div>
</section>
{% endblock %}